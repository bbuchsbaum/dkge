% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dkge-inference.R
\name{dkge_infer}
\alias{dkge_infer}
\title{Unified inference for DKGE contrasts}
\usage{
dkge_infer(
  fit,
  contrasts,
  method = c("loso", "kfold", "analytic"),
  inference = c("signflip", "freedman-lane", "parametric"),
  correction = c("maxT", "fdr", "bonferroni", "none"),
  n_perm = 2000,
  alpha = 0.05,
  transported = FALSE,
  transport = NULL,
  ...
)
}
\arguments{
\item{fit}{A `dkge` object from [dkge_fit()] or [dkge()]}

\item{contrasts}{Contrast specification (see [dkge_contrast()])}

\item{method}{Cross-fitting method: "loso", "kfold", or "analytic"}

\item{inference}{Inference type:
- `"signflip"`: Sign-flip permutation test (default)
- `"freedman-lane"`: Freedman-Lane permutation (requires adapters)
- `"parametric"`: Parametric t-test (assumes normality)}

\item{correction}{Multiple testing correction:
- `"maxT"`: Family-wise error rate via max-T (default)
- `"fdr"`: False discovery rate (Benjamini-Hochberg)
- `"bonferroni"`: Bonferroni correction
- `"none"`: No correction}

\item{n_perm}{Number of permutations for non-parametric tests}

\item{alpha}{Significance level for corrections}

\item{transported}{Logical; retained for backwards compatibility. Deprecated.}

\item{transport}{Optional list describing how to map subject clusters to a
shared reference before inference. Provide `centroids`, `medoid`, and an
optional mapper specification created via [dkge_mapper_spec()]. Additional
parameters (e.g. `epsilon`, `lambda_emb`) are forwarded when constructing
the default Sinkhorn mapper.}

\item{...}{Additional arguments passed to [dkge_contrast()] and inference functions}
}
\value{
An object of class `dkge_inference` containing:
  - `contrasts`: The contrast results from cross-fitting
  - `statistics`: Test statistics per cluster/voxel
  - `p_values`: Raw p-values
  - `p_adjusted`: Adjusted p-values based on correction method
  - `significant`: Logical indicators of significance
  - `method`: Cross-fitting method used
  - `inference`: Inference type used
  - `correction`: Correction method applied
  - `metadata`: Additional information about the analysis
}
\description{
High-level interface for statistical inference on DKGE contrasts with
integrated cross-fitting and multiple testing correction.
}
\details{
This function integrates the cross-fitting machinery from [dkge_contrast()]
with various statistical inference procedures. It first computes contrast
values using the specified cross-fitting method, then applies the chosen
inference procedure to obtain p-values, and finally applies multiple
testing correction.

When subject cluster counts differ across participants, supply the
`transport` argument so that contrasts are first mapped to a shared
parcellation before stacking. The resulting mapped subject matrices are
returned in the `transport` field of the output for downstream inspection.

The workflow is:
1. Compute contrast values via cross-fitting (LOSO/K-fold/analytic)
2. Apply inference procedure (sign-flip/Freedman-Lane/parametric)
3. Apply multiple testing correction (maxT/FDR/Bonferroni)

For sign-flip inference, the max-T correction provides strong FWER control.
For parametric inference, FDR may be more appropriate for exploratory analyses.
}
\examples{
\dontrun{
# Standard LOSO with sign-flip and maxT correction
results <- dkge_infer(fit, c(1, -1, 0, 0, 0))

# K-fold with parametric test and FDR
results <- dkge_infer(fit, c(1, -1, 0, 0, 0),
                     method = "kfold", folds = 5,
                     inference = "parametric",
                     correction = "fdr")

# Multiple contrasts with analytic approximation
contrasts <- list(
  main1 = c(1, -1, 0, 0, 0),
  main2 = c(0, 0, 1, -1, 0)
)
results <- dkge_infer(fit, contrasts, method = "analytic")

# Extract significant clusters for first contrast
sig_clusters <- which(results$significant[[1]])
}

}
\seealso{
[dkge_contrast()], [dkge_signflip_maxT()], [dkge_freedman_lane()]
}
