% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dkge-contrast.R
\name{dkge_contrast}
\alias{dkge_contrast}
\title{Compute DKGE contrasts with cross-fitting}
\usage{
dkge_contrast(
  fit,
  contrasts,
  method = c("loso", "kfold", "analytic"),
  folds = NULL,
  ridge = 0,
  parallel = FALSE,
  verbose = FALSE,
  align = TRUE,
  transport = NULL,
  ...
)
}
\arguments{
\item{fit}{A `dkge` object from [dkge_fit()] or [dkge()]}

\item{contrasts}{Either a q-length numeric vector for a single contrast,
a named list of contrasts, or a q×k matrix where columns are contrasts}

\item{method}{Cross-fitting strategy: "loso" (leave-one-subject-out),
"kfold" (K-fold cross-validation), or "analytic" (first-order approximation)}

\item{folds}{For method="kfold", either an integer K for random folds,
or a list defining custom fold assignments (see [dkge_define_folds()])}

\item{ridge}{Optional ridge parameter added when recomputing held-out basis}

\item{parallel}{Logical; use parallel processing for multiple contrasts}

\item{verbose}{Logical; print progress messages}

\item{align}{Logical; if TRUE (default) align LOSO/K-fold bases to a common reference and compute a consensus basis for reporting.}

\item{transport}{Optional list describing how to transport subject-level
contrasts to a shared reference parcellation. Supply either explicit
transport matrices via `transforms`/`matrices`, or configuration for the
medoid/atlas transport helpers (e.g., `method`, `centroids`, `medoid`). When
provided, the resulting transport bundle is stored under
`metadata$transport` for downstream reuse.}

\item{...}{Additional arguments passed to method-specific functions}
}
\value{
A list with class `dkge_contrasts` containing:
  - `values`: Named list of contrast values (one P_s vector per subject per contrast)
  - `method`: Cross-fitting method used
  - `contrasts`: Input contrast specifications
  - `metadata`: Method-specific metadata (fold assignments, bases, etc.)
}
\description{
Main entry point for computing design contrasts after DKGE fit, with support
for multiple cross-fitting strategies to ensure unbiased estimation.
}
\details{
This function provides a unified interface to three cross-fitting strategies:

1. **LOSO** (`method = "loso"`): Recomputes the basis excluding each subject,
   then projects that subject's data. This is the gold standard for unbiased
   estimation but requires S eigen-decompositions.

2. **K-fold** (`method = "kfold"`): Splits data into K folds, recomputes basis
   excluding each fold, projects held-out data. More efficient than LOSO while
   maintaining good bias properties. Supports time-based, run-based, or custom
   fold definitions.

3. **Analytic** (`method = "analytic"`): Uses first-order eigenvalue perturbation
   theory to approximate the LOSO solution without full recomputation. Fast but
   may be less accurate when subjects have high leverage.

All methods work entirely in the q×q design space and respect the K-metric
throughout. Multiple contrasts can be evaluated simultaneously for efficiency.
}
\examples{
\dontrun{
# Single contrast with LOSO
c1 <- c(1, -1, 0, 0, 0)  # Main effect difference
result <- dkge_contrast(fit, c1, method = "loso")

# Multiple contrasts with K-fold
contrasts <- list(
  main1 = c(1, -1, 0, 0, 0),
  main2 = c(0, 0, 1, -1, 0),
  interaction = c(1, -1, -1, 1, 0)
)
result <- dkge_contrast(fit, contrasts, method = "kfold", folds = 5)

# Fast analytic approximation
result <- dkge_contrast(fit, c1, method = "analytic")
}

}
\seealso{
[dkge_loso_contrast()], [dkge_define_folds()], [dkge_infer()]
}
