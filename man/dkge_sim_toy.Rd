% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dkge-sim.R
\name{dkge_sim_toy}
\alias{dkge_sim_toy}
\title{Simulate toy DKGE datasets with known factorial structure}
\usage{
dkge_sim_toy(
  factors,
  terms = NULL,
  active_terms,
  r_per_term = NULL,
  S = 3,
  P = 10,
  snr = 8,
  noise_scales = NULL,
  seed = 1L,
  contrasts_type = c("helmert", "sum")
)
}
\arguments{
\item{factors}{Named list describing the experimental factors (as for
[design_kernel()]), e.g. `list(A = list(L = 2), B = list(L = 3))`.}

\item{terms}{Optional list of character vectors specifying which terms to
include in the kernel. Defaults to the full factorial set used by
[design_kernel()].}

\item{active_terms}{Character vector of term names to activate (e.g.,
`c("A", "B", "A:B")`). These must be present in the kernel.}

\item{r_per_term}{Named integer vector giving how many latent columns to draw
within each active term. Defaults to one column per term.}

\item{S}{Number of subjects.}

\item{P}{Either a single integer (clusters/voxels per subject) or a length-`S`
integer vector.}

\item{snr}{Target Frobenius SNR (signal / noise) per subject. Scalar or
length-`S`.}

\item{noise_scales}{Optional length-`S` multipliers applied to the noise
standard deviation for each subject.}

\item{seed}{RNG seed for reproducibility.}

\item{contrasts_type}{Factor-contrast system, one of `"helmert"` or `"sum"`.}
}
\value{
A list with the following entries:
  \describe{
    \item{B_list}{List of `q x P_s` beta matrices.}
    \item{X_list}{List of subject-level design rulers (identity matrices).}
    \item{K}{`q x q` design kernel.}
    \item{info}{Design metadata returned by [design_kernel()].}
    \item{U_true}{Ground-truth `q x r_true` component basis (\eqn{K}-orthonormal).}
    \item{M_list}{Per-subject spatial patterns (`P_s x r_true`).}
    \item{active_cols}{Named list mapping each active term to the selected
      column indices in the effect basis.}
    \item{subject_ids}{Character vector of subject identifiers.}
  }
}
\description{
Generates subject-level beta matrices \eqn{B_s} (`q x P_s`) in effect space with
user-selected active design terms, controlled signal-to-noise ratio (SNR), and
per-subject noise levels. The routine also returns the per-subject design
'rulers' (typically identity matrices) and the design kernel \eqn{K} so the
synthetic dataset can be fed directly to [dkge_fit()]. Components are planted
inside chosen effect blocks, then \eqn{K}-orthonormalised to provide a ground
truth subspace.
}
\details{
Construction follows the model
\deqn{B_s = U_{true} M_s^\top + E_s,}
where `U_true` lies inside the requested design-term blocks, `M_s` encodes the
subject-specific spatial loadings, and `E_s` is Gaussian noise adjusted to hit
the requested Frobenius SNR.
}
